from itertools import product
from tkinter import *
from tkinter.messagebox import showerror, showinfo, showwarning
import shop


player = shop.Player(name="Игрок", initial_balance=1000, max_storage=500)

apple = shop.Product(name="Яблоко", purchase_price=50, sell_price=30, quantity=2, stak=True)
Arbyz = shop.Product(name="Арбуз", purchase_price=100, sell_price=80, quantity=5, stak=True)
Sword = shop.Product(name="Меч Хуже", purchase_price=200, sell_price=160, stak=False)

Shop = shop.Shop(name="Магазин")

player.inventory.append(apple)
player.inventory.append(Arbyz)
player.inventory.append(Sword)

def update_balance():
    balance.config(text=f"${player.balance}")

def update_inventory():
    inventory_list.delete(0, END)


    for product in player.inventory:
        inventory_list.insert(END, f"{product.name} // Стоимость продажи: {product.sell_price} // Количество: {product.quantity}")



def update_Shop_list():
    buy_list.delete(0, END)

    for shop in player.shop.shop_list:
        buy_list.insert(END,f"{shop.name} // Стоимость покупки: {shop.purchase_price}// Стоимость продажи: {shop.sell_price} // Количество: {shop.quantity}")



def more_button_click():
    buy_button.pack_forget()
    sell_button.pack_forget()
    exit_button.pack_forget()
    more_button.pack_forget()

    back_button.pack(side="bottom", fill="x", padx=0, pady=0)
    add_button.pack(side="bottom", fill="x", padx=0, pady=20)
    del_button.pack(side="bottom", fill="x", padx=0, pady=0)

def sell_button_click():
    del_prod = inventory_list.curselection()
    try:
        del_prod_idx = del_prod[0]
    except IndexError:
        print("Выберите товар для продажи")
        showinfo(title="Подсказка", message="Выберите товар для продажи! (нажать на товар в списке инвентаря)")
        return
    player.sell(del_prod_idx)



    update_balance()
    update_inventory()
    update_Shop_list()

def buy_button_click():
    add_prod = buy_list.curselection()
    try:
        add_prod_idx = add_prod[0]
    except IndexError:
        print("Выберите товар для покупки")
        showinfo(title="Подсказка", message="Выберите товар для покупки! (нажать на товар в списке магазина)" )
        return

    player.buy(add_prod_idx, quantity_to_buy=1)

    update_balance()
    update_inventory()
    update_Shop_list()

def add_button_click():
    add_window = Toplevel(window)
    add_window.title("Добавление товара (предмета)")
    add_window.geometry("430x430")
    add_window.resizable(False, False)
    add_window.configure(bg="black")


    Label(add_window,text=f"Название: ",bg="black",fg="white").pack(pady=5,anchor="w")
    name_entry = Entry(add_window)
    name_entry.place(x=10,y=25, width=80)

    Label(add_window, text=f"Стоимость покупки: ", bg="black", fg="white").pack(pady=15, anchor="w")
    purchase_entry = Entry(add_window)
    purchase_entry.place(x=10,y=67, width=80)

    Label(add_window, text=f"Стоимость продажи: ", bg="black", fg="white").pack(pady=5, anchor="w")
    sell_entry =  Entry(add_window)
    sell_entry.place(x=10, y=109, width=80)

    Label(add_window, text=f"Количество: ", bg="black", fg="white").pack(pady=15, anchor="w")
    quantity_entry = Entry(add_window)
    quantity_entry.place(x=10, y=151, width=80)

    Label(add_window, text=f"Стакается: ", bg="black", fg="white").pack(pady=7, anchor="w")
    stackable = BooleanVar()
    stackable.set(True)
    stak_checkbox = Checkbutton(
        add_window,
        variable=stackable,
        bg="black",
        fg="white",
        activebackground="black",
        activeforeground="white",
        selectcolor="grey")
    stak_checkbox.place(x=10, y=193, width=80)

def del_button_click():
    ## Доделать проверки #
    if len(inventory_list.curselection()) > 0:
        player.del_product_inventory(inventory_list.curselection()[0])
    elif len(buy_list.curselection()) > 0:
        player.del_product_shop(buy_list.curselection()[0])
    else:
        showinfo(title="Подсказка", message="Выберите предмет из инвентаря или магазина!")

    update_inventory()
    update_Shop_list()

def back_button_click():
    back_button.pack_forget()
    add_button.pack_forget()
    del_button.pack_forget()

    exit_button.pack(side="bottom",fill="x", padx=0, pady=0)
    buy_button.pack(side="bottom", fill="x", padx=0, pady=20)
    sell_button.pack(side="bottom", fill="x", padx=0, pady=20)
    more_button.pack(side="bottom", fill="x", padx=0, pady=20)


window = Tk()
window.title("Game")
window.geometry("730x640")
window.configure(bg="orange")

more_button_image = PhotoImage(file="more_button.png")
buy_button_image = PhotoImage(file="buy_button.png")
sell_button_image = PhotoImage(file="sell_button.png")
exit_button_image = PhotoImage(file="exit_button.png")

right_panel = Frame(window, bg="black", width=200, bd=6)
right_panel.pack(side="right", fill="y")

balance = Label(
    right_panel,
    text=f"$0",
    bg="black",
    fg="green",
    font=("Comic Sans MS", 20, "bold"),
    bd=6
)
balance.pack(pady=8, padx=5)

exit_button = Button(right_panel,
                     text="Exit",
                     bg="black",
                     fg="white",
                     font=("Comic Sans MS", 20, "bold"),
                     bd=6,
                     command=window.quit,
                     image=exit_button_image,
                     compound="right"
                    )
exit_button.pack(side="bottom",fill="x", padx=0, pady=0)

buy_button = Button(right_panel,
                    text="Buy",
                    bg="black",
                    fg="green",
                    font=("Comic Sans MS", 20, "bold"),
                    bd=6,
                    image=buy_button_image,
                    compound="right",
                    command=buy_button_click
                    )
buy_button.pack(side="bottom", fill="x", padx=0, pady=20)

sell_button = Button(right_panel,
                     text="Sell",
                     bg="black",
                     fg="red",
                     font=("Comic Sans MS", 20, "bold"),
                     bd=6,
                     image=sell_button_image,
                    compound="right",
                     command=sell_button_click)
sell_button.pack(side="bottom", fill="x", padx=0, pady=20)

more_button = Button(right_panel,
                     text="More",
                     bg="black",
                     fg="purple",
                     font=("Comic Sans MS", 20, "bold"),
                     bd=6,
                     image=more_button_image,
                     compound="right",
                     command=more_button_click
                     )
more_button.pack(side="bottom", fill="x", padx=0, pady=20)

add_button = Button(right_panel,
                    text="Add",
                    bg="black",
                    fg="green",
                    font=("Comic Sans MS", 20, "bold"),
                    bd=6,
                    command=add_button_click)

del_button = Button(right_panel,
                    text="Del",
                    bg="black",
                    fg="red",
                    font=("Comic Sans MS", 20, "bold"),
                    bd=6,
                    command=del_button_click)

back_button = Button(right_panel,
                     text="Back",
                     bg="black",
                     fg="white",
                     font=("Comic Sans MS", 20, "bold"),
                     bd=6,
                     command=back_button_click)

main_area = Frame(window, bg="yellow")
main_area.pack(expand=True, fill="both")

bottom_area = Frame(main_area, bg="black", bd=6, height=170)
bottom_area.pack(fill="x", side="bottom")

list_frame = Frame(main_area,
                   bg="black",)
list_frame.pack(fill="x")

inventory_label = Label(list_frame,
                        text="Инвентарь",
                        bg="black",
                        fg="white",
                        font=("Comic Sans MS", 20, "bold"))
inventory_label.pack()

inventory_list = Listbox(list_frame,
                         height=5,
                         bg="black",
                         fg="white")
inventory_list.pack(fill="x")

buy_list_label = Label(bottom_area,
                       text="Купить:",
                       bg="black",
                       fg="white",
                       font=("Comic Sans MS", 20, "bold"))
buy_list_label.pack(fill="x", side="top")

buy_list = Listbox(bottom_area,
                         height=5,
                         bg="black",
                         fg="white")
buy_list.pack(fill="x", side="bottom")





update_balance()
update_inventory()
update_Shop_list()

window.mainloop()